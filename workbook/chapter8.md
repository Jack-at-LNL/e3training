Chapter 8 : Build an e3 Application
==

## Lesson Overview

In this lesson, you'll learn how to do the following:
* Understand the difference between e3 Modules and its Applications
* Understand the e3 installation directory structure
* Can create an e3 application with a remote source repository with e3TemplateGenerator
* Can create an e3 application with local source files with e3TemplateGenerator
* Can edit a module makefile in order to build, and install its application into e3


## Modules, Applications, and IOCs

There is no clear boundary among modules, applications, and IOCs. Thus, we should define them according to what we would like to distinguish. However, to use them differently gives us more clear ideas how to handle the entire system concisely in terms of the ESS lifecycle. 

### Modules 
We can define generic EPICS modules, which we usually get from the EPICS community or in-house development. For example, `iocStats`, `mrfioc2`, `asyn`, or `autosave`. The installation location is defined as `E3_SITEMODS_PATH` discussed before in [Chapter 6](chapter6.md). The corresponding symbolic links are created within `E3_SITELIBS_PATH`. **Modules** within e3 are the core component in order to build a specific EPICS application. And in order to build the system IOC, one may need to combine **Modules** and **Applications** altogether. One needs to design e3-module_name repository and setup them via `e3TemplateGenerator`. We will discuss this subject in [Chapter 9](chapter9.md) and one can `require` any modules within e3. 


* Check `E3_SITEMODS_PATH`

We assume that one should be in **E3_TOP**. 
```
 e3-3.15.5 (master)$ source tools/setenv
 e3-3.15.5 (master)$ echo ${E3_SITEMODS_PATH}
 e3-3.15.5 (master)$ tree -L 2 ${E3_SITEMODS_PATH}
```

We can check `E3_SITELIBS_PATH` also.
```
e3-3.15.5 (master)$ echo ${E3_SITELIBS_PATH}
e3-3.15.5 (master)$ tree -L 4 ${E3_SITELIBS_PATH}
```

### Applications

We can define applications within e3 as a module which has customized features, i.e., unique sequencer files, and database files for an unique system. One needs to design e3-module_name repository and setup them via `e3TemplateGenerator` and one can `require` any application within e3. 

* Check `E3_SITEAPPS_PATH`

```
 e3-3.15.5 (master)$ echo ${E3_SITEMODS_PATH}
 e3-3.15.5 (master)$ tree -L 4 ${E3_SITEAPPS_PATH}
```

If one doesn't know which category can used for EPICS module or IOC, we can define that this case is in the **applications** if we have to install binary and scripts, or compile source files. In most cases, we can use the applications. 


### IOCs

With e3, IOC has only start up scripts. It may has its own repository, but not necessary to be generated by using `e3TemplateGenerator`. 


## How to to build an Application

Before doing this, we have to ask ourself the following questions:

* **Question 0** : Do you have existent source, db, proto, and sequencer files? 
  YES : Go to Question 1
  NO  : Go to Question 7

* **Question 1** : Does this application (source files) exist remotely or locally?

  Remotely : Go to Question 2
  Locally  : Go to Question 4
  
* **Question 2** : Does the remote repository have the standard EPICS structure?
  YES : Go to Step 1
  NO  : Go to Question 3
  
* **Question 3** : Do you keep its structure as it is? 
  YES : Go to Step 1
  NO  : Go to Question 6
  
* **Question 4** : Does local application has the standard EPICS structure?
  YES : Go to Step 2
  NO  : Go to Question 5
  
* **Question 5** : Do you want to keep them as an independent remote repository?
  YES, I would like to keep them remotely : Create one, and push them to there, and Go to Step 1
  NO, I would like to keep them locally : Go to Step 2
  
* **Question 6** : Do you want to migrate them into the e3 structure locally?
  YES : Go to Step 3
  NO  : We cannot identify which step can be applied in your case. 
  
* **Question 7** : Do you want to use the standard EPICS structure?
  YES : Create EPICS application, and go to Question 1
  NO  : Please go to Step 2, you can put your sources file within the e3 structure locally.
  
* **Step 1** 
   We can use `e3TemplateGenerator` with the remode mode.

* **Step 2** 
  We can use `e3TemplateGenerator` with the local mode.

* **Step 3**
  We will use `e3TemplateGenerator` with the local and migratory mode. The current `e3TemplateGenerator` doesn't support this mode will support it soon. At this moment, we have to go Step 2, and copy all files into relevant directories. 
  
  
  
  
  


<!-- ### EPICS Standard Strcuture with a remote repository -->

<!-- ### Existent EEE Structure with a remote repository -->

<!-- ### From scratch  -->

<!-- * Would like to keep the standard structure?  -->
<!-- * Would like to keep all into e3 local structure? -->
<!-- * Would like to keep them seperated remote repository with e3 structure? -->

<!-- ## Type 1 : To develop an e3 IOC quickly within e3 application structure -->

<!-- * Application with DB and Protocol Files with the existent EPICS IOC -->
<!-- * Application with DB and Protocol Files from scratch  -->

<!-- ## Type 2 :To develop an e3 IOC within e3 application structure -->

<!-- ### Type 2.1 : Application with DB and Protocol Files with the existent EPICS IOC -->
<!-- ### Type 2.2 : Source and Sequencer files based on Type 2.1 -->


<!-- ## Type 2 : -->

<!-- https://github.com/icshwi/fimscb -->


<!-- ## Type 2 : Application with S -->


------------------
[:arrow_backward:](chapter7.md)  | [:arrow_up_small:](chapter8.md)  | [:arrow_forward:](chapter9.md)
:--- | --- |---: 
[Chapter 7 : Understand A Module Dependence](chapter7.md) | [Chapter 8](chapter8.md) | [Chapter 9 : Build an e3 module](chapter9.md)
