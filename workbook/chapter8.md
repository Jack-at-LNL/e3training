Chapter 8 : Build an e3 Application
==

## Lesson Overview

In this lesson, you'll learn how to do the following:
* Understand the difference between e3 Modules and its Applications
* Understand the e3 installation directory structure
* Can create an e3 application with a remote source repository with e3TemplateGenerator
* Can create an e3 application with local source files with e3TemplateGenerator
* Can edit a module makefile in order to build, and install its application into e3


## Modules, Applications, and IOCs

There is no clear boundary among modules, applications, and IOCs. Thus, we should define them according to what we would like to distinguish. However, to use them differently gives us more clear ideas how to handle the entire system concisely in terms of the ESS lifecycle. 

### Modules 
We can define generic EPICS modules, which we usually get from the EPICS community or in-house development. For example, `iocStats`, `mrfioc2`, `asyn`, or `autosave`. The installation location is defined as `E3_SITEMODS_PATH` discussed before in [Chapter 6](chapter6.md). The corresponding symbolic links are created within `E3_SITELIBS_PATH`. **Modules** within e3 are the core component in order to build a specific EPICS application. And in order to build the system IOC, one may need to combine **Modules** and **Applications** altogether. One needs to design e3-module_name repository and setup them via `e3TemplateGenerator`. We will discuss this subject in [Chapter 9](chapter9.md) and one can `require` any modules within e3. 


* Check `E3_SITEMODS_PATH`

We assume that one should be in **E3_TOP**. 
```
 e3-3.15.5 (master)$ source tools/setenv
 e3-3.15.5 (master)$ echo ${E3_SITEMODS_PATH}
 e3-3.15.5 (master)$ tree -L 2 ${E3_SITEMODS_PATH}
```

We can check `E3_SITELIBS_PATH` also.
```
e3-3.15.5 (master)$ echo ${E3_SITELIBS_PATH}
e3-3.15.5 (master)$ tree -L 4 ${E3_SITELIBS_PATH}
```

### Applications

We can define applications within e3 as a module which has customized features, i.e., unique sequencer files, and database files for an unique system. One needs to design e3-module_name repository and setup them via `e3TemplateGenerator` and one can `require` any application within e3. 

* Check `E3_SITEAPPS_PATH`

```
 e3-3.15.5 (master)$ echo ${E3_SITEMODS_PATH}
 e3-3.15.5 (master)$ tree -L 4 ${E3_SITEAPPS_PATH}
```

If one doesn't know which category can used for EPICS module or IOC, we can define that this case is in the **applications** if we have to install binary and scripts, or compile source files. In most cases, we can use the applications. 


### IOCs

With e3, IOC has only start up scripts. It may has its own repository, but not necessary to be generated by using `e3TemplateGenerator`. 


## How to build an Application

There are many scenarios to build an application. However, we explain few scenarios, because one can customize it once one understand them correctly. And we introduce few **ACTION**s which help users how to build an application by using `e3Templategenerator`. 

Before finding the correct **ACTION**, one has to ask oneself the following questions:

### Questions 

* **Q00** : Do you have source codes? 
  YES : Go to Q01
  NO  : Go to Q03

* **Q01** : Is your source codes in a remote (git) repository?
  YES : Go to Q10
  NO  : You have source codes locally, Go to Q02

* **Q02** : Do you want to keep these source codes in a separated remote repository? 
  YES : Create your own repository, and push all local files to that repository. And go to ACTION 1
  NO  : Action 2

* **Q03** : You don't have any source codes, in this case, I would recommend to use the standard EPICS structure. Do you want to accept this suggestion? 
  YES : Follow Action 3, and then go to Q02
  NO : Follow Action 2, and put all source files into application-loc path


* **Q10** : Do you want to keep the old repository with its original forms?
  YES : Follow Action 1
  NO : ACTION 0


### ACTIONS 

* **ACTION 1** : e3TemplateGenerator with the remote mode
* **ACTION 2** : e3TemplateGenerator with the local mode 
* **ACTION 3** : Create your source structure with the standard EPICS way
* **ACTION 0** : You need to define how you migrate them into e3 template. The recommendation is to move them all into a local path, and do ACTION 2. If you don't like this recommendation, please contact the e3 mailing list or create the JIRA issue to get some helps. 



  


<!-- ### EPICS Standard Strcuture with a remote repository -->

<!-- ### Existent EEE Structure with a remote repository -->

<!-- ### From scratch  -->

<!-- * Would like to keep the standard structure?  -->
<!-- * Would like to keep all into e3 local structure? -->
<!-- * Would like to keep them seperated remote repository with e3 structure? -->

<!-- ## Type 1 : To develop an e3 IOC quickly within e3 application structure -->

<!-- * Application with DB and Protocol Files with the existent EPICS IOC -->
<!-- * Application with DB and Protocol Files from scratch  -->

<!-- ## Type 2 :To develop an e3 IOC within e3 application structure -->

<!-- ### Type 2.1 : Application with DB and Protocol Files with the existent EPICS IOC -->
<!-- ### Type 2.2 : Source and Sequencer files based on Type 2.1 -->


<!-- ## Type 2 : -->

<!-- https://github.com/icshwi/fimscb -->


<!-- ## Type 2 : Application with S -->


------------------
[:arrow_backward:](chapter7.md)  | [:arrow_up_small:](chapter8.md)  | [:arrow_forward:](chapter9.md)
:--- | --- |---: 
[Chapter 7 : Understand A Module Dependence](chapter7.md) | [Chapter 8](chapter8.md) | [Chapter 9 : Build an e3 module](chapter9.md)
